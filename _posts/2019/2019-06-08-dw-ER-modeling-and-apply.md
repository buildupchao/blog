---
title: 如何对数仓进行建模
tags: ['大数据', '数据仓库', 'DW']
category: datawarehouse
description: 如何从0到1建立数据仓库呢？那就come on and follow me!
keywords: 数据仓库,DW,Hadoop,数仓建模,建模
---

## 1.数仓建模First Blood

![](https://github.com/buildupchao/ImgStore/blob/master/blog/datawarehouse/dw-header.png?raw=true)

## 2.数仓建模的目的是什么呢？

- 提升访问性能

能够快速查询所需的数据，减少数据I/O

- 节省数据成本

减少不必要的数据冗余，实现计算结果数据复用，降低大数据系统中的存储成本和计算成本

- 提高使用效率

改善用户应用体验，提高使用数据的效率

- 保障数据质量

改善数据统计口径的不一致性，减少数据计算错误的可能性，提供高质量的、一致的数据访问平台

所以，大数据的数仓建模需要通过建模的方法更好的组织、存储数据，以便在性能、成本、效率和数据质量之间找到最佳平衡点。

## 3.回顾关系模式范式

众所周知，RDBMS设计时，需要遵照一定的规范要求，目的在于降低数据的冗余性和数据的一致性，目前业界范式有：

- <strong style="color:green;">1NF</strong>

域都应该是<strong style="color:red;">原子性（即不可分割的）</strong>的，即数据库表的每一列都是不可分割的原子数据项。

ID | 商品 | 商家ID | 用户ID
---|-----|--------|------
xxx | 4件毛衣 | xx毛衣生产商 | 10001

上述表格是不符合``` 1NF ```的，需要拆分为：

ID | 商品个数 | 商品名称 | 商家ID | 用户ID
---|--------|---------|--------|------
xxx | 4 | 毛衣 | xx毛衣生产商 | 10001

- <strong style="color:green;">2NF</strong>

在``` 1NF ```的基础上，实体的属性<strong style="color:red;">完全依赖于主关键字</strong>，不能存在仅依赖主关键字一部分的属性。

学生ID | 所属系 | 系主任 | 所修课程 | 分数
------|-------|-------|---------|-----
101 | 物理系 | 张三 | 100000001 | 90
101 | 物理系 | 张三 | 100000002 | 100

上述表格中，如果想表达某个学生分数的时候，是通过（学生ID，所修课程）来作为主键，唯一确定分数；而一个学生只能属于一个系，可以理解为所属系是依赖于学生ID的（即给出一个学生ID，就可以给出所属系），这就产生了局部依赖。

该表会带来什么问题呢？
- 1）如果学生所属系改变了，则需要更新该学生的所有记录的所属系和系主任，如果存在上万条记录呢？那么就会带来性能问题。
- 2）如果系主任改变了，同样需要做大量改动，也会带来性能问题。

所以作出如下拆分：

- 1) 表1：

学生ID | 所修课程 | 分数
------|---------|-----
101 | 100000001 | 90
101 | 100000002 | 100

- 2) 表2（该表满足``` 2NF ```，但是不满足``` 3NF ```，因为系主任依赖于所属系，所属系又依赖于学生ID，即传递依赖）：

学生ID | 所属系 | 系主任
------|-------|-------
101 | 物理系 | 张三

- <strong style="color:green;">3NF</strong>

在``` 2NF ```的基础上，<strong style="color:red;">任何非主属性不依赖于其他非主属性</strong>。

ID | 商品ID | 商品颜色 | 商家ID | 用户ID
---|-------|---------|-------|-------
xxx | 0002x | 白色 | xx公司 | 10000001

因为商品颜色依赖于商品ID，商品ID又依赖于ID，存在传递依赖。故拆分为：

- 1) 表1：

ID | 商品ID | 商家ID | 用户ID
---|-------|-------|-------
xxx | 0002x | xx公司 | 10000001

- 2) 表2：

商品ID | 商品颜色 | 尺寸
------|---------|-----
0002x | 白色 | 30*40

大多数RDBMS业务场景达到``` 3NF ```即可满足我们业务需求，后续三项范式不再展开介绍。

- <strong style="color:green;">BCNF</strong>
- <strong style="color:green;">4NF</strong>
- <strong style="color:green;">5NF</strong>

## 4.ER实体关系模型

### 4.1什么是ER模型？

在信息系统中，将事物抽象为“实体”、“属性”、“关系”来表示数据关联和事物描述。

三者用来做什么呢？

- 实体：通常为参与到过程中的主体，客观存在的，比如商品、仓库、货位、汽车等；此实体非数据库中的实体表。
- 属性：对主体的描述、修饰即为属性，比如商品的属性有商品名称、颜色、尺寸、重量、产地等。
- 关系：现实的物理事件是依附于实体的，比如商品入库事件，依附实体商品、货位，就会有“库存”的属性产生；用户购买商品，依附实体用户、商品，就会有“购买数量”、“金额”的属性产品。

实体之间建立关系时，存在哪些对照关系呢？

- 1:1，一对一关系，比如一个人有且仅有一个身份证号
- 1:n，一对多关系，比如一个班级有多个学生，但是一个学生只能属于一个班级
- m:n，多对多关系，比如学生选课，每个学生可以选修多门课程，每门课程也可以被多个学生选修

如何建立ER模型呢？

- 1）抽象出实体
- 2）梳理实体间的关系
- 3）梳理实体属性、关系属性
- 4）构建ER图

举个例子，教师、学生与课程之间的ER图：

![教师、学生与课程之间的ER图](https://github.com/buildupchao/ImgStore/blob/master/blog/datawarehouse/dw-modeling-ER-1.png?raw=true)

### 4.2小结

- ER模型是数据库设计的理论基础，当前几乎所有的OLTP系统设计都采用ER模型建模的方式
- Bill Inom提出的数仓理论，推荐采用ER关系模型进行建模
- BI架构提出分层架构，数仓底层ODS、DWD也多采用ER关系模型进行设计

## 5.维度建模



## 6.dataVault模型



## 7.Anchor
